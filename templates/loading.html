<link href="/static/css/loading.css" rel="stylesheet">

{% extends "layout-tabs.html" %}

{% block tabs %}

<style>
    .hidden-image {
        display: none;
    }

    .progress-container{
        display: flex;
        width: 100%;
        padding: 2px;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        gap: 10px;

        border-radius: 2px;
        background: var(--Azul-Azul-10, #EFF6FF);
        box-shadow: 1px 0px 6px 0px rgba(74, 79, 85, 0.10) inset;
    }

    .progress-bar-design{
        height: 10px;
        border-radius: 2px;
        background: linear-gradient(90deg, #0071BF 0%, #0661FC 49.5%, #B7E4FF 100%, #0091E9 100%);
    }


</style>

<div class="loading">
    <div class="animation">
        

        <img id="gifDisplay"  alt="">
        <img  src="/static/img/animation-loading-1.gif" alt="" class="hidden-image">
        <img  src="/static/img/animation-loading-2.gif" alt="" class="hidden-image">
        <img  src="/static/img/animation-loading-3.gif" alt="" class="hidden-image">
        <img  src="/static/img/animation-loading-4.gif" alt="" class="hidden-image">
        <img  src="/static/img/animation-loading-5.gif" alt="" class="hidden-image">
    </div>

    

    <div class="progress-bar">
        <p>Cargando...</p>
        <progress value="0" max="{{doc_number}}" id="Progress" style="display: none;"></progress>
        <div class="w3-light-grey progress-container">
            <div id="Progress_v2" class="w3-container  w3-round-large progress-bar-design" style="width: 0%;"></div>
        </div>
    </div>

    

    <div class="progress-count">
        <p><span id="counterValue">0</span> de <span id="doc_number">{{doc_number}}</span> archivos</p>
    </div>
</div>
<form action="/processing" method="POST" id="form">
    <input type="hidden" value="{{request_group}}" name="request_group">
</form>
<script>

    var gifPaths = ["animation-loading-1.gif", "animation-loading-2.gif", "animation-loading-3.gif", "animation-loading-4.gif", "animation-loading-5.gif"];
    var img = document.getElementById("gifDisplay")
    function carrucel(){
        img.src = "/static/img/"+gifPaths[0]
        setTimeout(function(){
            img.src = "/static/img/"+gifPaths[1]
        },3750);
        setTimeout(function(){
            img.src = "/static/img/"+gifPaths[2]
        },3800+4500);
        setTimeout(function(){
            img.src = "/static/img/"+gifPaths[3]
        },3800+(4500*2));
        setTimeout(function(){
            img.src = "/static/img/"+gifPaths[4]
        },3800+(4500*3));
    }

    window.onload = function(){
        carrucel();
        setInterval(carrucel, 21850);
        document.getElementById("form").submit();
        // fetchCounterSemaphoreValue();
        // setInterval(fetchCounterSemaphoreValue, 100); //
    };
    

    
</script>

<script>
    // Function to fetch counter semaphore value
    function update_progress_bar(new_value){
        let progressBar = document.getElementById('Progress');
        let old_value = progressBar.value;
        for(i=old_value; i<=new_value;i++){
            progressBar.value = i;
        }
    }


    async function fetchCounterSemaphoreValue() {
        let progressBar = document.getElementById('Progress');
        let progressBar_v2 = document.getElementById('Progress_v2');
        try {
            const response = await fetch('/get-counter-semaphore');
            const data = await response.json();
            
            // progressBar.value = data.counter_semaphore_value;
            if(data.counter_semaphore_value>=progressBar.value){
                progressBar.value = data.counter_semaphore_value;
                progressBar_v2.style.width = data.counter_semaphore_value/{{doc_number}}*100 + "%";
                document.getElementById('counterValue').textContent = data.counter_semaphore_value;
            }
            
        } catch (error) {
            console.error('Error fetching counter semaphore value:', error);
        }
    }

</script>
{% endblock %}